generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Type {
  id     Int      @id @default(autoincrement())
  name   String
  Region Region[]
  Party  Party[]
}

model Region {
  id        Int         @id @default(autoincrement())
  name      String
  type      Type        @relation(fields: [typeId], references: [id])
  typeId    Int
  parent    Region?     @relation("ChildRegion", fields: [parentId], references: [id])
  parentId  Int?
  child     Region[]    @relation("ChildRegion")
  Candidate Candidate[]
  Voter     Voter[]
  Ballot    Ballot[]
}

model Party {
  id             Int              @id @default(autoincrement())
  name           String
  abbr           String
  logo           String
  type           Type             @relation(fields: [typeId], references: [id])
  typeId         Int
  PartyCandidate PartyCandidate[]
  BallotParty    BallotParty[]
}

model Candidate {
  id         Int              @id @default(autoincrement())
  name       String
  region     Region           @relation(fields: [locationId], references: [id])
  locationId Int
  parties    PartyCandidate[]
}

model PartyCandidate {
  candidate   Candidate @relation(fields: [candidateId], references: [id])
  candidateId Int
  party       Party     @relation(fields: [partyId], references: [id])
  partyId     Int
  position    Int       @default(autoincrement())

  @@id([candidateId, partyId])
}

model Voter {
  id          Int           @id @default(autoincrement())
  name        String
  email       String
  key         String
  phone       String
  home        Region        @relation(fields: [locationId], references: [id])
  locationId  Int
  VoterBallot VoterBallot[]
}

model Ballot {
  id          Int           @id @default(autoincrement())
  name        String
  system      String
  minimum     Int
  maximum     Int
  location    Region        @relation(fields: [locationId], references: [id])
  locationId  Int
  VoterBallot VoterBallot[]
  BallotParty BallotParty[]
}

model VoterBallot {
  voter    Voter  @relation(fields: [voterId], references: [id])
  voterId  Int
  ballot   Ballot @relation(fields: [ballotId], references: [id])
  ballotId Int
  votedFor String

  @@id([voterId, ballotId])
}

model BallotParty {
  party    Party  @relation(fields: [partyId], references: [id])
  partyId  Int
  ballot   Ballot @relation(fields: [ballotId], references: [id])
  ballotId Int

  @@id([partyId, ballotId])
}
